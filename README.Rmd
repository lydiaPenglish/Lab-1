---
title: "Stat 585 - Lab 1"
author: "Lydia English, Earl Hur, Min Zhang"
date: "February 4, 2019"
output: html_document
---

```{r, cache=FALSE, echo=FALSE, warning=FALSE, message=FALSE}
library(readr)
library(dplyr)
library(openintro)
library(ggplot2)
library(maps)
library(tidyr)
```

##Document the error you encounter

There were many packages that needed to be installed to knit the index.Rmd. The first problem that we have ran into was that the *emo* package was not available from usual CRAN repository. Another issue came with an error message: *In system(cmd) : 'make' not found*

##Describe one approach on how you tried to solve the problem

Instead of install this package from the CRAN, we installed this package through hadley's github. Using *devtools::install_github("hadley/emo")*, we could successfully install the package.

Another error we have come across is in the Rcpp.Rmd document:

`Line 77 Error in sourceCpp(code = code, env = env, rebuild = rebuild, cacheDir = cacheDir, :`
`Error 1 occured building shared library. Calls: local ... withVisible -> eval -> eval -> cppFunction -> sourceCpp`

If we navigate to line 77 in the Rcpp.Rmd document we find the following script:

```{r add, eval=FALSE}
cppFunction('int add(int x, int y, int z) {
  int sum = x + y + z;
  return sum;
}')
# add works like a regular R function
add
add(1, 2, 3)
```

We've tried downloading and updating Rtools and making sure other packages were updated but this was unsuccessful. However another group member was succesfully able to knit the .html file so this wasn't a problem across all computers. 

The last unsolvable problem occurred in Line 783 in `Conditions.Rmd`. Not sure about the meaning of the error message: `err` inherits from `warning/condition` not `error_bad_argument`. So the chunck of Lines 783-788 was comment out to avoid error message.  

##US Weather Stations

**Plotting Weather Stations in the U.S.**

```{r, cache=FALSE, message=FALSE}

col_positions <- readr::fwf_widths(
  c(2, 1, 2, 6, 9, 10, 8, 2, 30, 8, 8, 7, 2)
)

weather <- data.frame(readr::read_fwf("ushcn-v2.5-stations.txt", col_positions = col_positions))

names(weather) <- c("Country", "Network", "ID", "COOP", "Latitude", "Longitude", "Elevation", "State", "Name", "Comp1", "Comp2", "Comp3", "DIFF")

weather$DIFF <- as.factor(weather$DIFF)

states_map <- map_data("state") # data for outlines of US states

tzcolor <- c("plum","lightcoral", "khaki", "lightblue") 

weather <- weather %>% 
  mutate(StateFull = tolower(abbr2state(State)))

states_txt <- data.frame(state.center, state.abb)
states_txt <- states_txt[-which(states_txt$state.abb %in% c("AK", "HI")), ]

ggplot(weather) +
  geom_map(aes(map_id = StateFull, fill = DIFF), size=1, color="white", map = states_map) +
  expand_limits(x = states_map$long, y = states_map$lat) +
  geom_point(aes(Longitude, Latitude, colour = Elevation), cex = 1.5) +
  geom_text(data = states_txt, aes(x = x, y = y, label = state.abb), size = 3, fontface = "bold")+
  labs(x = "", y = "", title = "Weather Station") +
  scale_colour_gradientn(colours=c("forestgreen","goldenrod","brown2"))+
  scale_fill_manual("Time Zone", breaks = c(5,6,7,8), values = tzcolor, 
                    labels = c( "Eastern", "Central", "Mountain", "Pacific"), guide = "legend") +
  theme(panel.background = element_blank(), 
        axis.text.x=element_blank(),
        axis.text.y=element_blank(),
        line = element_blank())
  
```


## More Weather Data

**Downliading gz file and making it available from R.**
```{r, cache=FALSE}
temp <- tempfile()
download.file("ftp://ftp.ncdc.noaa.gov/pub/data/ushcn/v2.5/ushcn.tavg.latest.raw.tar.gz",temp)
untar(temp)
unlink(temp)
```

**Count the number of files.**
```{r, cache=FALSE}
FileList <- list.files('./ushcn.v2.5.5.20190205')
FileList %>% length()
```

**Name of the file containing Lydia's hometown.**
```{r, cache=FALSE}
weather %>% 
  separate(Name, c('City', 'Other'), sep=" ", extra = "merge", fill = "right")%>% 
  filter(City == "PROVIDENCE", State == "RI") %>% 
  mutate(FileName = paste0(Country, Network, ID, COOP, ".raw.tavg")) %>% 
  pull(FileName)

```

Lydia's hometown is Providence RI, and it corresponds to USH00376698.
